Inspectie Leefomgeving en Transport Ministerie van Infrastructuur en Waterstaat

# Koppelvlakspecificatie Centrale Database Taxivervoer Meldingen-API

Versie 1.0.4

|     |     |
| --- | --- |
| Datum | 6 juni 2025 |
| Status | Definitief |


# COLOFON

Locatie Rijnstraat 8, 2515XP Den Haag Contact afdeling aansluitmanagement cdtaansluiting@ILenT.nl ILT/Informatie, netwerken en programmering Inspectie Leefomgeving en Transport (ILT) Ministerie van Infrastructuur en Waterstaat

- - -

Koppelvlakspecificatie CDT aanlevering toezichtgegevens - Productie

# VERSIE-INFORMATIE

| Versie | Datum | Bijzonderheden |
| --- | --- | --- |
| 1.0 | 20-12-2024 | Introductie v2 van de API, initiële versie |
| 1.0.1 | 15-01-2025 | regels onder figuur in 3.1 consistent gemaakt met werking van API; inconsistenties in beschrijving responses aangepast; Bij valideren chauffeur met buitenlands rijbewijs kan validatiecode 1 niet Expliciet toegevoegd dat ritprijs exclusief fooi is |
| 1.0.2 | 31-03-2025 | Foutmelding OF02 toegevoegd voor niet gevonden chauffeursnummer. |
| 1.0.3 | 15-04-2025 | Validatie DF09 toegevoegd voor negatieve duur van de dienst. Validatie DF10 toegevoegd voor einde dienst voor einde verrichtingen. Op aanmelden dienst is authenticatie bij aanleveren door ondernemer toegevoegd. |
| 1.04 | 06-06-2025 | Definities overgenomen van wettelijke regeling CDT; Enkele tekstuele aanpassingen; 7.1.2 en 7.1.3 uitgebreid |


Inspectie Leefomgeving & Transport 1.0.4 06-06-2025

- - -

Koppelvlakspecificatie CDT aanlevering toezichtgegevens - Productie

# REFERENTIES

| NR  | Naam | Opmerkingen |
| --- | --- | --- |
| REF-1 | Cdt-2.x.y.json | Open API specificatie van de REST API t.b.v. CDT. NB: x en y hangen af van de actuele softwareversie van de CDT Meldingen API |
| REF-2 | DA42EN-Electronic-Driving-Licence-Reading-Manual-v2-3.pdf | Handleiding van de Rijksdienst voor het Wegverkeer (RDW) voor het elektronische uitlezen van het Nederlandse rijbewijs. |
| REF-3 | DA12 - Kentekencard Uitleesdocumentatie v2 1 1.pdf | Handleiding van de Rijksdienst voor het Wegverkeer (RDW) voor het elektronische uitlezen van het Nederlandse kentekenbewijs. |


Inspectie Leefomgeving & Transport 1.0.4 06-06-2025

- - -

Koppelvlakspecificatie CDT aanlevering toezichtgegevens - Productie

# TERMINOLOGIE

Deze begrippen zijn opgenomen om dit document zelfstandig leesbaar te maken. Leidend voor de begrippen in deze tabel zijn de definities in het Besluit Personenvervoer 2000 en de Ministeriële Regeling CDT.

| Definitie | Omschrijving |
| --- | --- |
| Andere werkzaamheden | Andere werkzaamheden zijn werkzaamheden die de chauffeur heeft uitgevoerd voorafgaand aan de taxivervoer werkzaamheden. Deze worden gemeld bij het aanmelden van de dienst. |
| CDT-Meldingen-API | Voorziening voor het uitwisselen van taxivervoergegevens tussen een applicatie en de centrale database taxivervoer; |
| Centrale applicatie | Applicatie die taxivervoergegevens ontvangt van een of meerdere registratiemiddelen en deze aanlevert aan de CDT via de CDT meldingen API |
| Centrale Database Taxivervoer (CDT) | Centrale database van de ILT waar de taxivervoergegevens worden bewaard en verwerkt door de ILT. De CDT is de bron voor de ILT met betrekking tot de taxivervoergegevens vanuit het registratiemiddel chauffeur en functionaliteit voor de ondernemer. centrale |
| Chauffeur (of taxichauffeur) | Natuurlijk persoon die een taxidienst uitvoert en daarbij de auto waarmee taxivervoer wordt verricht bestuurt in opdracht van de ondernemer. In de wet- en regelgeving wordt hiervoor de term Bestuurder gebruikt. |
| Dienst | Een periode van arbeidstijd waarin de taxichauffeur in de auto werkt. NB: deze definitie wijkt af van de definitie in de Arbeidstijdenwet. |
| Gebeurtenis | voorval dat plaatsvindt binnen het registratiemiddel, zijnde een melding, fout of storing. voor CDT gaat het altijd om meldingen. Een gebeurtenis wordt door het registratiemiddel chauffeur doorgegeven aan de centrale applicatie. Een gebeurtenis is gerelateerd aan een dienst en geeft duiding over de omstandigheden waaronder de taxivervoergegevens worden verzameld. |
| ICT-dienstverlener | Organisatie die taxivervoergegevens aanlevert aan de Centrale Database Taxivervoer namens één of meer taxivervoerders. De ICT-dienstverlener kan zelf een taxivervoerder zijn of een organisatie die werkt in opdracht van taxivervoerders. |
| Inspectie Leefomgeving en Transport (ILT) | Rijksdienst van het Ministerie van Infrastructuur en Waterstaat. De Inspectie Leefomgeving en Transport houdt onder andere toezicht op de veiligheid en een eerlijke concurrentie in het taxivervoer. Zij doet dit aan de hand van wettelijke regels die zijn opgesteld voor een chauffeur, een ondernemer en het voertuig. |
| Melding | Bericht dat wordt verstuurd naar de CDT Meldingen API |
| Ondernemer (of taxiondernemer) | Gemachtigde vertegenwoordiger van een onderneming die taxiritten uitvoert. In de wet- en regelgeving wordt hiervoor Vervoerder gebruikt. |
| Pauze | Pauze als omschreven in artikel 1:7, eerste lid, onderdeel e Arbeidstijdenwet. Deze luidt: een periode van ten minste 15 achtereenvolgende minuten, waarmee de arbeid tijdens de dienst wordt onderbroken en de werknemer geen enkele verplichting heeft ten aanzien van de bedongen arbeid. |
| Realtime | Direct, onmiddellijk, zonder vertraging. |
| Registratiemiddel chauffeur | Vormvrije combinatie van apparatuur en programmatuur waarmee de chauffeur onmiddellijk diensten en verrichtingen voor een specifieke ondernemer registreert in een centrale applicatie. Het registratiemiddel chauffeur registreert daarnaast ook gebeurtenissen in een centrale applicatie. |
| Rit | Verrichting binnen een dienst waarbij de chauffeur passagiers vervoert. |
| Taxivervoergegevens | Gegevens als bedoeld in artikel 83b, tweede lid, van het Besluit Personenvervoer 2000. Deze gegevens worden geregistreerd door de registratiemiddelen en realtime aangeleverd aan de CDT via de CDT-Meldingen-API. |
| Verrichting | Verrichtingen zijn acties binnen een dienst van het type rit of pauze. |
| Voertuig | Een auto die gebruikt wordt voor het verrichten van taxivervoer. |


Inspectie Leefomgeving & Transport 1.0.4 06-06-2025

- - -

Koppelvlakspecificatie CDT aanlevering toezichtgegevens - Productie

# INHOUDSOPGAVE

|     |     |     |
| --- | --- | --- |
| 1   | **INLEIDING** | 1   |
|     | 1.1 Context | 1   |
|     | 1.2 Doel | 1   |
| 2   | **PROCESSEN** | 2   |
|     | 2.1 Aanmelden dienst (relateren chauffeur, ondernemer en voertuig). | 2   |
|     | 2.2 Aanmelden rit en aanmelden pauze. | 2   |
|     | 2.3 Afmelden rit en afmelden pauze | 3   |
|     | 2.4 Afmelden dienst. | 3   |
|     | 2.5 Aanmelden ICT-dienstverlener | 3   |
|     | 2.6 Afmelden ICT-dienstverlener. | 3   |
|     | 2.7 Valideren van chauffeur | 4   |
|     | 2.8 Opvragen van openstaande diensten en verrichtingen | 4   |
|     | 2.9 Melden van gebeurtenissen van het registratiemiddel chauffeur | 4   |
|     | 2.10 Opvragen chauffeursnummer. | 5   |
| 3   | **BERICHTEN** | 6   |
|     | 3.1 Statusovergangen | 6   |
|     | 3.2 Generieke berichtgegevens in headers | 7   |
|     | 3.3 Functionele berichtgegevens | 7   |
|     |     | 3.3.1 Chauffeur |
|     |     | 3.3.2 Rijbewijs |
|     |     | 3.3.3 Authenticatie. |
|     |     | 3.3.4 Ondernemer |
|     |     | 3.3.5 Voertuig |
|     |     | 3.3.6 Andere werkzaamheden |
|     |     | 3.3.7 Locatie |
|     | 3.4 Aanmelden dienst (relateren chauffeur, ondernemer en voertuig). | 11  |
|     | 3.5 Afmelden dienst | 12  |
|     | 3.6 Aanmelden rit | 12  |
|     | 3.7 Afmelden rit | 13  |
|     | 3.8 Aanmelden pauze | 13  |
|     | 3.9 Afmelden pauze | 14  |
|     | 3.10 Aanmelden ICT-dienstverlener | 14  |
|     | 3.11 Afmelden ICT-dienstverlener. | 15  |
|     | 3.12 Valideren chauffeur | 15  |
|     | 3.13 Opvragen van openstaande diensten en verrichtingen | 16  |
|     | 3.14 Melden van gebeurtenissen van het registratiemiddel chauffeur | 17  |
|     | 3.15 Opvragen chauffeursnummer. | 18  |
|     | 3.16 Foutmeldingscodes. | 19  |
|     |     | 3.16.1 Foutmeldingen wegens headers |
|     |     | 3.16.2 Foutmeldingen wegens fouten in het bericht zelf. |
|     |     | 3.16.3 Foutmeldingen wegens verwerken inhoud |
| 4   | **TECHNISCHE EISEN** | 27  |
|     | 4.1 Conventies | 27  |
|     |     | 4.1.1 JSON conventies |
|     |     | 4.1.2 Encoding. |
|     |     | 4.1.3 Hoofdlettergevoeligheid. |
|     |     | 4.1.4 Datum/tijd |
|     |     | 4.1.5 Berichtenverkeer |
|     |     | 4.1.6 Endpoints |
|     | 4.2 Actualiteit van data | 27  |
|     | 4.3 Beschikbaarheid en performance | 28  |
|     |     | 4.3.1 Beschikbaarheid.. |
|     |     | 4.3.2 Performance |
| 5   | **LOGGING EN MONITORING VERBINDING** | 29  |
|     | 5.1 Logging | 29  |
|     | 5.2 Connectie-monitoring | 29  |
| 6   | **FOUTAFHANDELING** | 30  |
|     | 6.1 Algemeen. | 30  |
|     | 6.2 Error in aanroep dienstgerelateerde endpoints. | 30  |
|     | 6.3 Error in aanroep /verbinding | 30  |
|     | 6.4 Duplicaat detectie | 30  |
| 7   | **AUTHENTICATIE EN INFORMATIEBEVEILIGING** | 31  |
|     | 7.1 Authenticatie | 31  |
|     |     | 7.1.1 PKI Certificaten |
|     |     | 7.1.2 Authenticatie rijbewijs |
|     |     | 7.1.3 Authenticatie kentekenbewijs |
|     | 7.2 Informatiebeveiliging. | 31  |
|     |     | 7.2.1 Transport Layer Security (TLS) |
|     |     | 7.2.2 API-keys |
|     | 7.3 Headers. | 33  |


Inspectie Leefomgeving & Transport 1.0.4 06-06-2025

- - -

# 1 INLEIDING

Deze koppelvlakspecificatie geeft een beschrijving van de volgende functies van de CDT-Meldingen-API:

1.  Het aanleveren van diensten, ritten en pauzes door de ondernemer;

2.  Het **valideren van chauffeursgegevens**;

3.  Het **opvragen van openstaande diensten en verrichtingen** binnen de CDT;

4.  Het **aan- en afmelden van ICT-dienstverleners** door ondernemers;

5.  Het **melden van gebeurtenissen** van het registratiemiddel chauffeur gerelateerd aan een dienst.

6.  Het **opvragen van het chauffeursnummer** van een taxichauffeur op basis van het nummer van zijn Nederlandse rijbewijs.


## 1.1 Context

De chauffeur maakt gebruik van een **Registratiemiddel Chauffeur** om **realtime** relevante informatie over de uitvoering van taxivervoer te registreren voor de ondernemer in de **centrale applicatie**, die de gegevens wederom realtime levert aan de **CDT**. Voor de uitwisseling van berichten met de ILT is de **CDT-Meldingen-API** (op basis van REST) ontwikkeld die aangeroepen dient te worden door de Centrale Applicatie.

## 1.2 Doel

Dit document is een bijlage bij de Regeling CDT. Het doel van dit document is om aan partijen die gebruik willen maken van de CDT Meldingen API inzicht te verschaffen in de functies en werking van de CDT-Meldingen-API.

- - -

# 2 PROCESSEN

In deze koppelvlakspecificatie wordt de term "**dienst**" gebruikt zoals dat in het dagelijks spraakgebruik wordt gedaan. De betekenis van dienst in dit document is daardoor niet de definitie van Dienst in art 1.7 eerste lid onder c van de Arbeidstijdenwet. Met "**dienst**" wordt in deze koppelvlakspecificatie "**de werkzaamheden aan boord van de auto waarmee taxivervoer wordt verricht**" bedoeld.

De volgende processen zijn in scope voor de aanlevering bij de CDT:

1.  Aanmelden dienst (relateren chauffeur, ondernemer en voertuig);

2.  Melden andere werkzaamheden van de chauffeur voorafgaand aan de dienst;

3.  Aanmelden rit of pauze;

4.  Afmelden rit of pauze;

5.  Afmelden dienst;

6.  Aanmelden ICT-dienstverlener door ondernemer;

7.  Afmelden ICT-dienstverlener door ondernemer;

8.  Valideren van chauffeur;

9.  Opvragen van openstaande diensten en verrichtingen;

10.  Doorgeven van gebeurtenissen van het registratiemiddel chauffeur;

11.  Opvragen van chauffeursnummer.


## 2.1 Aanmelden dienst (relateren chauffeur, ondernemer en voertuig)

**Preconditie** De ondernemer heeft ervoor gezorgd dat:

1.  De ICT-dienstverlener is aangemeld bij de CDT Meldingen API;

2.  Het voertuig is gevalideerd;

3.  De chauffeur is gevalideerd;

4.  De chauffeur toegang heeft tot het 'registratiemiddel chauffeur'.


**Proces** De chauffeur:

1.  Authenticeert zich met een toegestane authenticatiemethode;

2.  Voegt eventueel begin- en eindtijden in van andere werkzaamheden die voorafgaand aan de dienst zijn uitgevoerd;

3.  Meldt de dienst, met daarop de ondernemer en het voertuig, via het registratiemiddel chauffeur aan bij de centrale applicatie, die vervolgens de dienst **onmiddellijk** aanmeldt bij de CDT-Meldingen-API.


**Postconditie** De aanmelding van de dienst is geregistreerd voor de chauffeur, het voertuig en de ondernemer in de centrale applicatie en in de CDT. De optionele aanmelding van de andere werkzaamheden is geregistreerd voor de chauffeur.

## 2.2 Aanmelden rit en aanmelden pauze

**Preconditie**

*   De dienst waarbinnen de rit of pauze plaatsvindt, is aangemeld en geregistreerd in de centrale applicatie en de CDT;

*   Bij aanmelden pauze: er zijn geen niet-afgemelde ritten of pauzes binnen deze dienst;

*   Bij aanmelden rit: er zijn geen niet-afgemelde pauzes binnen deze dienst;


**Proces**

*   De chauffeur meldt via het registratiemiddel chauffeur de rit of pauze aan bij de centrale applicatie, die vervolgens de rit of pauze **onmiddellijk** aanmeldt bij de CDT-Meldingen API. Bij het aanmelden van een rit is de **locatie verplicht**. Indien er geen actuele locatie beschikbaar is wordt de laatst bekende locatie doorgegeven.


**Postconditie** De aanmelding van de rit of pauze is geregistreerd binnen de dienst van de chauffeur in de centrale applicatie en de CDT.

## 2.3 Afmelden rit en afmelden pauze

**Preconditie** De rit of pauze is geregistreerd in de centrale applicatie en de CDT.

**Proces** De chauffeur meldt via het registratiemiddel chauffeur de rit of pauze af bij de centrale applicatie, die vervolgens de rit of pauze **onmiddellijk** afmeldt bij de CDT-Meldingen-API.

**Postconditie** De afmelding van de rit of pauze is geregistreerd binnen de dienst voor de chauffeur en de ondernemer in de centrale applicatie en de CDT.

## 2.4 Afmelden dienst

**Preconditie** De dienst is geregistreerd en alle ritten en pauzes binnen de dienst zijn afgemeld in de centrale applicatie en de CDT.

**Proces** De chauffeur meldt via het registratiemiddel chauffeur de dienst af bij de centrale applicatie, die vervolgens de dienst **onmiddellijk** afmeldt bij de CDT-Meldingen-API.

**Postconditie** De afmelding van de dienst is geregistreerd in de centrale applicatie en de CDT.

## 2.5 Aanmelden ICT-dienstverlener

**Preconditie** De ondernemer neemt een ICT oplossing af bij de ICT-dienstverlener en heeft de ICT-dienstverlener niet aangemeld bij de CDT Meldingen API.

**Proces** De centrale applicatie stuurt de aanmelding van de ondernemer voor de ICT-dienstverlener naar de CDT Meldingen API.

**Postconditie** De ICT-dienstverlener is door de ondernemer aangemeld bij de CDT Meldingen API.

## 2.6 Afmelden ICT-dienstverlener

**Preconditie** De ondernemer is gestopt met het afnemen van de ICT oplossing van de ICT-dienstverlener en; De ICT-dienstverlener is door de ondernemer aangemeld bij de CDT Meldingen API.

**Proces** De centrale applicatie stuurt de afmelding van de ondernemer voor de ICT-dienstverlener naar de CDT Meldingen API.

**Postconditie** De ICT-dienstverlener is door de ondernemer afgemeld bij de CDT Meldingen API.

## 2.7 Valideren van chauffeur

**Preconditie** Ondernemer beschikt niet over de informatie of een chauffeur bevoegd is.

**Proces** Ondernemer valideert via de Centrale applicatie de chauffeursgegevens bij de CDT. **NB: alleen bij validatiecode 0 worden de chauffeursgegevens als gevalideerd beschouwd.**

**Postconditie** Ondernemer beschikt over de informatie of de opgegeven chauffeursgegevens van een bevoegde chauffeur zijn.

## 2.8 Opvragen van openstaande diensten en verrichtingen

**Preconditie** Centrale applicatie beschikt niet over de informatie welke diensten en verrichtingen langer dan een opgegeven duur open staan in de CDT.

**Proces** Centrale applicatie vraagt diensten en verrichtingen op die langer dan een gespecificeerde tijdsduur (**minimaal 24 uur**) openstaan bij de CDT.

**Postconditie** Centrale applicatie beschikt over de informatie met betrekking tot welke diensten en verrichtingen langer dan de gespecificeerde tijdsduur open staan in de CDT.

## 2.9 Melden van gebeurtenissen van het registratiemiddel chauffeur

Gebeurtenissen van het registratiemiddel chauffeur zijn meldingen (M). Een nadere toelichting hierop is te vinden in paragraaf 3.14 van dit document.

**Preconditie** De dienst waaraan de gebeurtenis is gerelateerd, is aangemeld en geregistreerd in de centrale applicatie en de CDT.

**Proces** Het registratiemiddel chauffeur meldt de gebeurtenis bij de centrale applicatie, die vervolgens de gebeurtenis **onmiddellijk** meldt bij de CDT-Meldingen-API.

**Postconditie** De gebeurtenis is geregistreerd in de centrale applicatie en de CDT.

## 2.10 Opvragen chauffeursnummer

Het chauffeursnummer staat niet vermeld op de beschikking bij chauffeurskaarten die zijn uitgegeven voor 2025. Om het chauffeursnummer te achterhalen kan op basis van de gegevens van een **Nederlands rijbewijs** het chauffeursnummer opgevraagd worden bij de CDT Meldingen API.

**Preconditie** Chauffeur en ondernemer beschikken niet over het chauffeursnummer en chauffeur heeft een geldig Nederlands rijbewijs en zijn BSN is geregistreerd bij Kiwa.

**Proces** Ondernemer vraagt op basis van het Nederlandse rijbewijs van de chauffeur het chauffeursnummer op bij de CDT.

**Postconditie** Indien de chauffeur beschikt over een geldige taxibevoegdheid, levert de CDT het chauffeursnummer terug aan de ondernemer. **NB:** voor chauffeurs die geen Nederlands rijbewijs hebben of die bij KIWA niet met een BSN geregistreerd zijn is het niet mogelijk het chauffeursnummer op basis van rijbewijsgegevens op te vragen. Deze chauffeurs ontvangen het chauffeursnummer per brief van KIWA, en dienen het chauffeursnummer door te geven aan de ondernemer.

- - -

# 3 BERICHTEN

Berichten bestaan uit **generieke berichtgegevens** (metagegevens) en de inhoud van het bericht zelf. ILT heeft ervoor gekozen om de metagegevens als **headers** in het bericht op te nemen.

## 3.1 Statusovergangen

De logische samenhang tussen de berichten en de status van een dienst en verrichting is in onderstaande figuur weergegeven. De berichten "opvragen openstaande diensten" en "valideren chauffeurs" komen niet voor in onderstaand figuur omdat ze geen invloed hebben op de status van diensten en verrichtingen.

**Regels:**

*   Diensten mogen alleen worden aangemeld door een **aangemelde ICT-dienstverlener**;

*   Het aanmelden van een verrichting (rit of pauze) vereist een **aangemelde dienst**;

*   Het aanmelden van een gebeurtenis vereist een **aangemelde dienst**;

*   Om een dienst te kunnen afmelden moeten **alle verrichtingen** binnen die dienst afgemeld zijn;

*   Gebeurtenissen kunnen worden gemeld tijdens een dienst, ongeacht of er een verrichting plaats vindt;

*   De volgende regels gelden bij overlappende verrichtingen:
    *   Overlappende ritten zijn toegestaan;
    *   Tijdens een rit kan **geen pauze** worden aangemeld;
    *   Tijdens een pauze kan **geen rit** worden aangemeld...
*   Een pauze kan alleen gemeld worden met een aanmeldtijdstip dat ligt **na de laatst afgemelde verrichting**.

## 3.2 Generieke berichtgegevens in headers
De velden in de onderstaande tabel staan de bericht header.

| Veldnaam | Type/lengte | Voorbeeld | Toelichting |
| --- | --- | --- | --- |
| **Dienstverlener** | UUID | `a0eebc99-9c0b-4ef8-bb6d-6bb9bd380a11` | Door ILT uitgegeven sleutel die de aanleverende ICT-dienstverlener uniek identificeert bij de CDT-Meldingen-API. |
| **ext\_key** | UUID | `a0eebc99-9c0b-4ef8-bb6d-6bb9bd380a11` | Unieke sleutel voor toegang tot de API-gateway |
| **Bericht-Id** | UUID | `a0eebc99-9c0b-4ef8-bb6d-6bb9bd380a11` | Identificatie van een bericht. **NB: dit dient gegenereerd te worden bij het verzenden van het bericht.** |
| **Verzendtijdstip** | `date-time` in UTC conform IETF RFC3339 | `2023-03-31T14:55:44Z` of `2023-03-31T14:55:44.444Z` | Verzendtijdstip van bericht van ICT-dienstverlener naar ILT. **NB: dit tijdstip dient bij iedere verzendpoging geactualiseerd te worden.** |
| **Softwareversie-Registratiemiddel** | String(20) | `v12.23.124` | Softwareversie van het registratiemiddel. |
| **Softwareversie-Centrale-Applicatie** | String (20) | `v2.2.9` | Softwareversie van de Centrale applicatie |


_1: Softwareversie-Registratiemiddel mag een empty string zijn als het bericht niet afkomstig is van een "registratiemiddel chauffeur"._

## 3.3 Functionele berichtgegevens

De velden in de onderstaande tabel kunnen op een bericht voorkomen (in de message body), per bericht is beschreven welke van deze velden voorkomen. Daarnaast staan in paragrafen 3.3.1 tot en met 3.3.7 objecten die in berichten kunnen voorkomen.

| Veldnaam | Type/lengte | Voorbeelden | Toelichting |
| --- | --- | --- | --- |
| **id** | UUID | `a0eebc99-9c0b-4ef8-bb6d-6bb9bd380a11` | Identificatie van een dienst, verrichting of gebeurtenis **NB: dit dient gegenereerd te worden bij het ontstaan van de dienst, verrichting of gebeurtenis.** |
| **aanmeldtijdstip** | `date-time` in UTC conform IETF RFC3339 | `2023-03-31T14:55:44Z` of `2023-03-31T14:55:44.444Z` | Het tijdstip waarop de dienst of verrichting is gestart. **NB: dit is het tijdstip op het registratiemiddel.** |
| **afmeldtijdstip** | `date-time` in UTC conform IETF RFC3339 | `2023-03-31T14:55:44Z` of `2023-03-31T14:55:44.444Z` | Het tijdstip waarop de dienst of verrichting is beëindigd. **NB: dit is het tijdstip op het registratiemiddel.** |
| **ritprijs** | Integer(6) | `10170` | Totale eindprijs van de afgelegde rit in eurocenten. **Dit is exclusief fooi.** |
| **afstand** | Numeric (4,1) | `12,1` | Afgelegde afstand van rit |
| **registratietijdstip** | `date-time` in UTC conform IETF RFC3339 | `2023-03-31T14:55:44Z` of `2023-03-31T14:55:44.444Z` | Het tijdstip waarop registratie plaatsvindt op het registratiemiddel. |
| **gebeurtenistijdstip** | `date-time` in UTC conform IETF RFC3339 | `2023-03-31T14:55:44Z` of `2023-03-31T14:55:44.444Z` | Tijdstip dat de gebeurtenis plaatsvindt op het registratiemiddel. |
| **gebeurteniscode** | String(4) | `M106` | code uit tabel in paragraaf 3.14 |


**Regels:**

*   Bij het bericht is aangegeven welke velden verplicht zijn;

*   Bericht wordt afgewezen als velden niet het juiste formaat of opmaak hebben;

*   Bericht wordt afgewezen als verplichte velden ontbreken;

*   Bericht wordt afgewezen als andere dan toegestane velden aanwezig zijn;

*   Bericht wordt afgewezen als toegestane velden vaker dan gespecificeerd voorkomen.


Naast de velden in bovenstaande tabel kunnen ook objecten worden verstuurd. Deze staan in de volgende paragrafen beschreven.

### 3.3.1 Chauffeur

| onderdelen | type | RegEx | voorbeeld | Toelichting |
| --- | --- | --- | --- | --- |
| **chauffeursnummer** | String(8) | `^T\\d{7}$` | `T0012345` | Chauffeursnummer zoals uitgegeven door KIWA |
| **gevalideerd** | boolean |     | `true` | indicatie of rijbewijs bij CDT Meldingen API gevalideerd is. Deze mag alleen op `true` worden gezet als op aanroep van `POST https://[host]/v2/chauffeurs/valideren` validatiecode **0** is teruggegeven voor de combinatie chauffeur/ondernemer. |
| **rijbewijs** | object |     |     | zie paragraaf 3.3.2 |


**Voorbeeld:**

JSON

```
"chauffeur": {
  "chauffeursnummer": "T0012345",
  "gevalideerd": true,
  "rijbewijs": {
    "land": "NL",
    "nummer": "123456789"
  }
}
```

### 3.3.2 Rijbewijs

| onderdelen | type | RegEx | voorbeeld | Toelichting |
| --- | --- | --- | --- | --- |
| **land** | string(2) | `^[A-Z]{2}$` | `NL` | Landcode volgens **ISO3166-1 alpha-2** |
| **rijbewijsnummer** | string(16) | `^[0-9a-zA-Z]{1,16}$` | `1234567890` | Een Nederlands rijbewijsnummer bestaat uit 10 cijfers, andere landen kunnen afwijken. Streepjes, spaties en punten worden weggelaten. |


**Voorbeeld:**

JSON

```
"rijbewijs": {
  "land": "NL",
  "rijbewijsnummer": "123456789"
}
```

### 3.3.3 Authenticatie

| onderdelen | type | RegEx | voorbeeld | Toelichting |
| --- | --- | --- | --- | --- |
| **middel** | string{4} | \`RBNL | BIO | 2FA |
| **kenmerk** | string(32) |     | `1234565677` `vingerafdruk` `gezichtsherkenning` `wachtwoord-SMS` `pincode-koppelcode` `geen` | Bij RBNL → rijbewijsnummer. Bij BIO → vingerafdruk, gezichtsherkenning. Bij 2FA → wachtwoord-SMS, wachtwoord-koppelcode, pincode-SMS, pincode-koppelcode. Bij geen → geen. |


**Voorbeelden:**

JSON

```
"authenticatie": {
  "middel": "RBNL",
  "kenmerk": "2090710264"
}
"authenticatie": {
  "middel": "BIO",
  "kenmerk": "gezichtsherkenning"
}
"authenticatie": {
  "middel": "2FA",
  "kenmerk": "wachtwoord-SMS"
}
"authenticatie": {
  "middel": "geen",
  "kenmerk": "geen"
}
```

### 3.3.4 Ondernemer

| onderdelen | type | RegEx | voorbeeld | Toelichting |
| --- | --- | --- | --- | --- |
| **kiwaNummer** | string(7) | `^P\\d{4,6}$` | `P123456` | nummer van KIWA taxivergunning |
| **kvkNummer** | string(8) | `^\\d{8}$` | `12345678` | Kamer van Koophandel nummer |


**Voorbeeld:**

JSON

```
"ondernemer": {
  "kvkNummer": "12345678",
  "kiwaNummer": "P1234"
}
```

### 3.3.5 Voertuig

| onderdelen | type | RegEx | voorbeeld | Toelichting |
| --- | --- | --- | --- | --- |
| **kenteken** | string(6) | `^[0-9A-Z]{6}$` | `P390HV` | kenteken van het voertuig |
| **validatiemethode** | string (1) | \`K | N\` | `K` |
| **validatiedatum** | string(10) | `^\d{4}-\d{2}-\d{2}$` | `2024-03-04` | datum waarop validatie is uitgevoerd, format **YYYY-MM-DD**. Als `validatiemethode = "N"` dan de huidige datum gebruiken. |


**Voorbeeld:**

JSON

```
"voertuig": {
  "kenteken": "P390HV",
  "validatiemethode": "N",
  "validatiedatum": "2024-03-04"
}
```

### 3.3.6 Andere werkzaamheden

| onderdelen | type | voorbeeld | Toelichting |
| --- | --- | --- | --- |
| **begintijdstip** | `date-time` in UTC conform IETF RFC3339 | `2023-03-31T14:55:44.444Z` | datum en tijdstip waarop andere werkzaamheden zijn gestart |
| **eindetijdstip** | `date-time` in UTC conform IETF RFC3339 | `2023-03-31T14:55:44.444Z` | datum en tijdstip waarop andere werkzaamheden zijn geëindigd |


**Voorbeeld:**

JSON

```
"andere Werkzaamheden": [
  {
    "begintijdstip": "2023-03-31T14:44:55.000Z",
    "eindetijdstip": "2023-03-31T15:44:55.000Z"
  },
  {
    "begintijdstip": "2023-03-31T18:44:55.000Z",
    "eindetijdstip": "2023-03-31T19:44:55.000Z"
  }
]
```

### 3.3.7 Locatie

| onderdelen | type | RegEx | voorbeeld | Toelichting |
| --- | --- | --- | --- | --- |
| **breedtegraad** | string | \`^\[-+\]?(90(.0{4,6})? | (\[1-\]?\\d(.\\d{4,6})?))$\` | `5.100056` |
| **lengtegraad** | string | \`^\[-+\]?(180(.0{4,6})? | ((1\[0-7\] | \[1-9\])?\\d(.\\d{4,6})?))$\` |


**Voorbeeld:**

JSON

```
"locatie": {
  "breedtegraad": "5.10005",
  "lengtegraad": "52.08649"
}
```

## 3.4 Aanmelden dienst (relateren chauffeur, ondernemer en voertuig)

**Use cases:** Aanmelden dienst bij aanvang van de werkzaamheden aan boord van de auto waarmee taxivervoer wordt verricht, eventueel met voorafgaande andere werkzaamheden.

**Endpoint:** `POST https://[host]/v2/diensten`

| Veldnaam | Verplicht |
| --- | --- |
| **id** (van de dienst) | ja  |
| **chauffeur** | ja  |
| **authenticatie** | ja  |
| **ondernemer** | ja  |
| **voertuig** | ja  |
| **aanmeldtijdstip** | ja  |
| **registratietijdstip** | ja  |
| **andere Werkzaamheden** | nee |


**Response sunny day: '201 CREATED'**

Velden in de response body:

*   `data`

*   `id`


Meldingen in de onderstaande tabel zijn mogelijk bij een '201 CREATED' resultaatcode.

| Status-code | Melding-code | Meldingtekst | Opmerking |
| --- | --- | --- | --- |
| 201 | **DF00** | Er zijn \[#\] diensten actief voor de chauffeur bij de ICT-dienstverlener. | Er is voor de opgegeven chauffeur nog een niet-afgesloten dienst bij ILT geregistreerd bij deze ICT-dienstverlener. |
| 201 | **DF06** | 'voertuig.kenteken' is in gebruik op een andere dienst bij de ICT-dienstverlener. | Er is voor het opgegeven voertuig nog een niet-afgesloten dienst bij ILT geregistreerd bij de ICT-dienstverlener. |
| 201 | **DF07** | 'chauffeur' is niet gevalideerd terwijl deze als gevalideerd is gemarkeerd. | Een chauffeur mag alleen als gevalideerd worden gemeld als een geslaagde validatie is uitgevoerd. |
| 201 | **DF08** | 'ICT-dienstverlener' is niet aangemeld voor ondernemer | Een ondernemer moet aanmelden welke ICT-dienstverlener voor hem levert. |


**Response bij openstaande diensten: '201 CREATED'**

Gegevens van openstaande dienst(en) bij de inzendende ICT-dienstverlener staan in de message body.

Velden in de response body:

JSON

```
data: {
  id: "...",
  meldingen: [
    {
      code: "...",
      tekst: "...",
      details: [
        {
          openstaande Diensten: [
            {
              id: "...",
              aanmeldtijdstip: "...",
              openstaande Verrichtingen: [
                {
                  id: "...",
                  aanmeldtijdstip: "..."
                }
              ]
            }
          ]
        }
      ]
    }
  ]
}
```

## 3.5 Afmelden dienst

**Use cases:** Afmelden dienst bij einde van de werkzaamheden aan boord van de auto waarmee taxivervoer wordt verricht.

**Endpoint:** `POST https://[host]/v2/diensten/{dienst.id}/afmelden`

| Veldnaam | Verplicht |
| --- | --- |
| **afmeldtijdstip** | ja  |
| **registratietijdstip** | ja  |


**Response sunny day: '200 OK'**

Velden in de response body:

*   `data`

*   `id`


Indien foutcode **DF05** wordt teruggegeven is de response: `'400'`.

JSON

```
data: {
  foutmelding: "bericht afgekeurd",
  aantal: "...",
  fouten: [
    {
      code: "...",
      tekst: "...",
      details: {
        openstaande Verrichtingen: [
          {
            id: "...",
            aanmeldtijdstip: "..."
          }
        ]
      }
    }
  ]
}
```

## 3.6 Aanmelden rit

**Use cases:** Aanmelden rit als (eerste) passagier instapt.

**Endpoint:** `POST https://[host]/v2/diensten/{dienst.id}/ritten`

| Veldnaam | Verplicht |
| --- | --- |
| **id** (van de rit) | ja  |
| **aanmeldtijdstip** | ja  |
| **registratietijdstip** | ja  |
| **locatie** | ja  |


**Response sunny day: '201 CREATED'**

Velden in de response body:

*   `data`

*   `id`


## 3.7 Afmelden rit

**Use cases:** Afmelden rit als (laatste) passagier uitstapt.

**Endpoint:** `POST https://[host]/v2/diensten/{dienst.id}/ritten/{rit.id}/afmelden`

| Veld | Verplicht |
| --- | --- |
| **afmeldtijdstip** | ja  |
| **registratietijdstip** | ja  |
| **afstand** | ja  |
| **ritprijs** | ja  |


**NB.** Bij contractvervoer en groepsvervoer is de prijs niet verplicht. In dat geval mag `ritprijs` **0 (nul)** zijn.

**Response sunny day: '200 OK'**

Velden in de response body:

*   `data`

*   `id`


## 3.8 Aanmelden pauze

**Use cases:** Aanmelden pauze bij aanvang pauze;

**Endpoint:** `POST https://[host]/v2/diensten/{dienst.id}/pauzes`

| Veldnaam | Verplicht |
| --- | --- |
| **id** (van de pauze) | ja  |
| **aanmeldtijdstip** | ja  |
| **registratietijdstip** | ja  |


**Response sunny day: '201 CREATED'**

Velden in de response body:

*   `data`

*   `id`


## 3.9 Afmelden pauze

**Use cases:** Afmelden pauze bij einde pauze;

**Endpoint:** `POST https://[host]/v2/diensten/{dienst.id}/pauzes/{pauze.id}/afmelden`

| Veld | Verplicht |
| --- | --- |
| **afmeldtijdstip** | ja  |
| **registratietijdstip** | ja  |


**Response sunny day: '200 OK'**

Velden in de response body:

*   `data`

*   `id`


## 3.10 Aanmelden ICT-dienstverlener

**Use case:** ondernemer meldt zich aan voor gebruik van ICT oplossing van ICT-dienstverlener.

**Endpoint:** `POST https://[host]/v2/ondernemers/aanmelden`

| Veld | Verplicht |
| --- | --- |
| **ondernemer** | ja  |


**Response sunny day: '200 OK'**

Velden in de response body:

JSON

```
data: {
  validaties: [
    {
      validatiecode: "...",
      verificatie-omschrijving: "..."
    }
  ]
}
```

| Validatiecode | Verificatie-omschrijving |
| --- | --- |
| **0** | 'ondernemer.kiwaNummer' is van vergunde taxiondernemer; 'ondernemer.kvkNummer' is van een bestaande onderneming |
| **1** | 'ondernemer.kiwaNummer' is onbekend |
| **2** | 'ondernemer.kiwaNummer' is niet van een vergunde taxiondernemer |
| **3** | 'ondernemer.kvkNummer' is onbekend |
| **4** | 'ondernemer.kvkNummer' is van niet-actieve onderneming |


## 3.11 Afmelden ICT-dienstverlener

**Use case:** ondernemer stopt met gebruik maken van ICT oplossing van ICT-dienstverlener.

**Endpoint:** `POST https://[host]/v2/ondernemers/{ondernemer.kiwaNummer}/afmelden`

**Response sunny day: '200 OK'**

Er is geen message body aanwezig. Als de ondernemer onbekend is bij de ICT-dienstverlener wordt als response '404 - not found' gegeven.

## 3.12 Valideren chauffeur

**Use cases:**

*   Controleren of van een chauffeur het Nederlands rijbewijsnummer en chauffeursnummer geldig zijn en van dezelfde persoon zijn.

*   Controleren of chauffeursnummer van een chauffeur met een buitenlands rijbewijs bestaat en geldig is.


**Endpoint:** `POST https://[host]/v2/chauffeurs/valideren`

| Veld | Verplicht |
| --- | --- |
| **chauffeur** | ja  |
| **ondernemer** | ja  |


**NB:** het chauffeursobject heeft het onderdeel "**gevalideerd**". De waarde hiervan moet `false` zijn bij deze opvraging.

**Response sunny day: '200 OK'**

Velden in de response body:

JSON

```
data: {
  validaties: [
    {
      validatiecode: "...",
      validatieomschrijving: "..."
    }
  ]
}
```

| Validatiecode | omschrijving bij Nederland rijbewijs | omschrijving bij buitenlands rijbewijs |
| --- | --- | --- |
| **0** | 'chauffeur.chauffeursnummer' is van bevoegde chauffeur; 'chauffeur.rijbewijs.rijbewijsnummer' is van een geldig rijbewijs en beiden zijn van dezelfde chauffeur | 'chauffeur.chauffeursnummer' is van een bevoegde chauffeur |
| **1** | 'chauffeur.chauffeursnummer' is van een andere chauffeur dan 'chauffeur.rijbewijs.rijbewijsnummer' | niet van toepassing |
| **2** | 'chauffeur.chauffeursnummer' onbekend | 'chauffeur.chauffeursnummer' onbekend |
| **3** | 'chauffeur.rijbewijs.rijbewijsnummer' onbekend | niet van toepassing |
| **4** | 'chauffeur.chauffeursnummer' is van onbevoegde chauffeur | 'chauffeur.chauffeursnummer' is van onbevoegde chauffeur |
| **5** | rijbewijs is ongeldig | niet van toepassing |


## 3.13 Opvragen van openstaande diensten en verrichtingen

**Use case:** Opvragen openstaande diensten en verrichtingen.

**Endpoint:** `GET https://[host]/v2/diensten/openstaand?ouderdan=24`

Geeft alle niet-afgemelde diensten met eventueel niet-afgemelde verrichtingen met een aanmeldtijdstip langer dan `x` uur geleden voor ICT-dienstverlener Y, waarbij `x` een defaultwaarde heeft van **24**. Een lagere waarde dan 24 wordt genegeerd.

**Response sunny day: '200 OK'**

Velden in de response body:

JSON

```
data: {
  openstaande Diensten: [
    {
      id: "...",
      aanmeldtijdstip: "...",
      openstaande Verrichtingen: [
        {
          id: "...",
          aanmeldtijdstip: "..."
        }
      ]
    }
  ]
}
```

Als er geen openstaande diensten zijn dan krijgt de aanroep een **'204 No Content'** response zonder message body.

## 3.14 Melden van gebeurtenissen van het registratiemiddel chauffeur

**Use case:** Een gebeurtenis op het registratiemiddel chauffeur melden bij de ILT.

**Endpoint:** `POST https://[host]/v2/diensten/{dienstId}/gebeurtenissen`

| Veld | Verplicht |
| --- | --- |
| **id** (van de gebeurtenis) | Ja  |
| **gebeurtenistijdstip** | Ja  |
| **registratietijdstip** | Ja  |
| **gebeurteniscode** | Ja  |
| **authenticatie** | Nee \*1 |
| **locatie** | Nee \*1 |


_1: zie tabel hieronder wanneer dit veld verplicht is._

De codes voor Meldingen zijn verplicht.

| Gebeurteniscode | Omschrijving | Veld verplicht |
| --- | --- | --- |
| **M100** | Authenticatiepoging voor en tijdens dienst niet succesvol. | `authenticatie` |
| **M101** | Uitval van registratiemiddel chauffeur tijdens dienst. |     |
| **M102** | Geen positiebepaling langer dan 3 minuten. | `locatie` (laatst bekende locatie) |
| **M103** | Positiebepaling succesvol na gebeurtenis M102. | `locatie` |
| **M104** | Tijd op registratiemiddel langer dan 10 minuten niet gesynchroniseerd. |     |
| **M105** | Tijd op registratiemiddel gesynchroniseerd na melding synchronisatieprobleem. |     |
| **M106** | Geen beweging gedetecteerd langer dan 1 minuut tijdens verrichting 'rit' terwijl positiebepaling beweging suggereert. |     |
| **M107** | beweging gedetecteerd terwijl positiebepaling beweging suggereert na melding M106. |     |
| **M108** | Geen gegevensverbinding langer dan 1 minuut met registratiemiddel chauffeur. |     |
| **M109** | Gegevensverbinding hersteld met registratiemiddel chauffeur na onderbreking. |     |
| **M110** | Dienst afgemeld door ondernemer |     |
| **M111** | Verrichting afgemeld door ondernemer |     |
| **M112** | Per ongeluk gestarte dienst/verrichting afgesloten. |     |
| **M113** | Ritprijs is handmatig opgevoerd. |     |


**Response sunny day: '201 OK'**

Velden in de response body:

*   `data`

*   `id`


## 3.15 Opvragen chauffeursnummer

**Use case:** Opvragen van een chauffeursnummer op basis van een Nederlands rijbewijsnummer.

**Endpoint:** `POST https://[host]/v2/chauffeursnummer/opvragen`

| Veld | Verplicht |
| --- | --- |
| **rijbewijs** | Ja  |


**Response als gevonden: '200 OK'**

Velden in de response body:

*   `data`

*   `chauffeursnummer`


## 3.16 Foutmeldingscodes

Fouten worden teruggegeven in de response body in het onderstaande format:

JSON

```
data: {
  foutmelding: "...",
  aantal: "...",
  fouten: [
    {
      code: "...",
      tekst: "...",
      details: {
        openstaande Verrichtingen: [
          {
            id: "...",
            aanmeldtijdstip: "..."
          }
        ]
      }
    }
  ]
}
```

| Code prefix | Soort fout |
| --- | --- |
| **Hxxx** | technische fout in (een van de) header(s). |
| **HFxx** | functionele fout in (een van de) header(s). |
| **Gxxx** | generieke (technische) fout. |
| **DFxx** | functionele fout in dienstbericht. |
| **VFxx** | functionele fout in verrichtingbericht. |
| **BFxx** | functionele fout in gebeurtenisbericht. |
| **OFxx** | functionele fout in opvraging |


### 3.16.1 Foutmeldingen wegens headers

| Status-code | Melding-code | Meldingtekst | Toelichting |
| --- | --- | --- | --- |
| 400 | **H000** | Ontbrekende header <headernaam>. | Dienstverlener, BerichtId-, Softwareversie-Registratiemiddel, Softwareversie-Centrale-Applicatie of Verzendtijdstip ontbreekt. |
| 400 | **H001** | Waarde van 'Bericht-Id' voldoet niet aan de opmaak. | Moet UUID zijn |
| 400 | **H002** | Waarde van 'Verzendtijdstip' voldoet niet aan de opmaak. | IETF RFC3339 "date-time" specificatie. |
| 400 | **H003** | Waarde van 'Verzendtijdstip' is in de toekomst. | Een bericht kan niet in de toekomst zijn verzonden. |
| 400 | **H004** | Waarde van 'Softwareversie-Registratiemiddel' voldoet niet aan de opmaak. | `^[0-9A-Za-z.-]{2,20}$`, mag in specifieke gevallen empty string zijn. |
| 400 | **H005** | Waarde van 'Softwareversie-Centrale-Applicatie' voldoet niet aan de opmaak. | `^[0-9A-Za-z.-]{2,20}$` |
| 400 | **H006** | Waarde van 'Dienstverlener' voldoet niet aan de opmaak. | Moet UUID zijn |
| 400 | **HF00** | Onbekende Dienstverlener. | Dienstverlenercode is niet actief of onbekend. |
| 400 | **HF10** | Bericht-Id is niet uniek. | De BerichtId op de header moet uniek zijn |


### 3.16.2 Foutmeldingen wegens fouten in het bericht zelf

| Status-code | Code | Tekst | Toelichting |
| --- | --- | --- | --- |
| 400 | **G000** | Ongeldige JSON. | Geldt voor het hele bericht: ongeldige JSON formattering. |
| 400 | **G010** | 'aanmeldtijdstip' ontbreekt. | Verplicht veld |
| 400 | **G022** | Waarde van 'registratietijdstip' is in de toekomst. | De datum/tijd mag niet in de toekomst zijn. |
| 400 | **G030** | 'afmeldtijdstip' ontbreekt. | Verplicht veld |
| 400 | **G041** | Waarde van 'id' voldoet niet aan de opmaak. | UUID |
| 400 | **G062** | Waarde van 'chauffeur.chauffeursnummer' voldoet niet aan de opmaak. | Format `^T\\d{7}$`, bijv. T0012345. |
| 400 | **G074** | Waarde van 'chauffeur.rijbewijs.land' voldoet niet aan de opmaak. | landcode conform ISO3166-1 alpha-2 |
| 400 | **G092** | Waarde van 'ondernemer.kiwaNummer' voldoet niet aan de opmaak. | Eerste positie is altijd een 'P', overige 6 posities zijn cijfers. |
| 400 | **G103** | Waarde van 'voertuig.kenteken' voldoet niet aan de opmaak. | Regex `^[0-9A-Z]{6}$` |
| 400 | **G132** | Waarde van 'locatie.breedtegraad' voldoet niet aan de opmaak. | Numeric(8,6) |
| 400 | **G134** | Waarde van 'locatie.lengtegraad' voldoet niet aan de opmaak. | Numeric(9,6) |
| 400 | **G140** | 'afstand' ontbreekt. | Verplicht bij afmelden rit |
| 400 | **G150** | 'ritprijs' ontbreekt. | Verplicht bij rit |


_(De volledige tabel is erg lang. Bovenstaande is een selectie van de meest relevante Gxxx codes. De tabel in het brondocument bevat foutcodes G001 t/m G191.)_

### 3.16.3 Foutmeldingen wegens verwerken inhoud

| Status-code | Code | Tekst | Toelichting |
| --- | --- | --- | --- |
| 400 | **DF01** | Waarde van 'aanmeldtijdstip' is binnen een andere dienst. | Een dienst kan alleen aangemeld worden wanneer de begintijd van de dienst niet overlapt met een afgemelde dienst voor dezelfde chauffeur. |
| 400 | **DF02** | Waarde van 'id' is niet uniek. | Identificatie moet uniek zijn |
| 400 | **DF05** | Er zijn niet-afgemelde verrichtingen op deze dienst. | Een dienst kan worden afgemeld als alle verrichtingen op die dienst zijn afgemeld. |
| 400 | **DF09** | Waarde van 'afmeldtijdstip' ligt voor 'aanmeldtijdstip' van de dienst | Een dienst kan niet worden afgemeld voor een tijdstip dat ligt voor het aanmeldtijdstip |
| 400 | **VF01** | Verrichting binnen dienst kan niet eerder beginnen dan dienst |     |
| 400 | **VF04** | Waarde van 'afmeldtijdstip' is voor 'aanmeldtijdstip' van verrichting. | Een verrichting binnen een dienst kan niet eindigen voor het begin van de verrichting |
| 400 | **VF06** | Waarde van 'aanmeldtijdstip' van pauze is binnen rit of pauze. | Een pauze mag niet overlappen met een andere verrichting. |
| 400 | **VF07** | Waarde van 'aanmeldtijdstip' van rit is binnen gemelde pauze. | Een rit kan niet worden gestart als: eerder een pauze is aangemeld en niet afgemeld; het aanmeldtijdstip valt binnen een aan- en afgemelde pauze. |
| 404 | **OF02** | Geen chauffeursnummer gevonden voor opgegeven rijbewijs | Er is geen chauffeursnummer gevonden voor het opgeven rijbewijs. |


_(De volledige tabel is erg lang. Bovenstaande is een selectie van de meest relevante DFxx, VFxx, BFxx en OFxx codes. De tabel in het brondocument bevat foutcodes DF01 t/m DF11, VF01 t/m VF11, BF01 en OF01 t/m OF02.)_

- - -

# 4 TECHNISCHE EISEN

## 4.1 Conventies

### 4.1.1 JSON conventies

De Centrale applicatie dient de berichten aan te bieden aan de endpoints van CDT-Meldingen-API door middel van **JSON** (JavaScript Object Notation) berichten en **REST** (Representational State Transfer). Velden die geen waarde hebben worden **weggelaten**.

### 4.1.2 Encoding

De character-encoding standaard van de berichten is **UTF-8**.

### 4.1.3 Hoofdlettergevoeligheid

De backend service CDT is **WEL** hoofdlettergevoelig.

### 4.1.4 Datum/tijd

Voor datum en tijd wordt **IETF RFC 3339** standaard gehanteerd, specifiek de specificatie van de 'date-time' waarde. Alle tijdstippen zijn in **UTC**.

### 4.1.5 Berichtenverkeer

Het berichtenverkeer wordt **synchroon** afgehandeld. Indien er sprake is van een **time-out** (`> 15 seconden`) dient de Centrale applicatie het bericht opnieuw aan te bieden.

### 4.1.6 Endpoints

Alle endpoints zijn gespecificeerd in de OpenAPI specificatie \[REF-1\].

## 4.2 Actualiteit van data

Berichten dienen **zonder vertraging** aangeleverd te worden aan de backend service CDT. Elk bericht bevat twee tijdstempels: het moment waarop het feit heeft plaatsgevonden (`aanmeldtijdstip` of `afmeldtijdstip`) en het moment waarop het bericht over deze actie wordt aangemaakt (`registratietijdstip`). De ICT-dienstverlener is ervoor verantwoordelijk dat berichten op **chronologische volgorde van registratietijdstip** worden aangeleverd.

## 4.3 Beschikbaarheid en performance

### 4.3.1 Beschikbaarheid

De API heeft een gegarandeerde beschikbaarheid van **98%**.

### 4.3.2 Performance

De streeftijd voor het afhandelen van een bericht is **< 2 seconden**.

- - -

# 5 LOGGING EN MONITORING VERBINDING

## 5.1 Logging

De ICT-dienstverlener wordt verwacht alle transacties op de CDT-Meldingen-API te **loggen**, inclusief de response van ILT. Deze gegevens dienen **minimaal 1 maand** te worden bewaard.

## 5.2 Connectie-monitoring

Om te monitoren of verbinding mogelijk is, stuurt de ICT-dienstverlener als er langer dan **60 seconden** geen andere melding is gestuurd een `GET` naar **`https://[host]/v2/verbinding`**, waarop ILT een `200 OK` zal terugsturen. **NB:** indien de aanroep naar dit endpoint niet slaagt mogen andere transacties niet worden aangeroepen totdat deze aanroep weer slaagt.

- - -

# 6 FOUTAFHANDELING

## 6.1 Algemeen

Als een bericht met betrekking op een dienst wordt afgewezen dienen chronologisch volgende berichten voor dezelfde dienst **vastgehouden** te worden totdat het afgewezen bericht succesvol is verwerkt.

Als het `/verbinding`\-endpoint een **`500-error`** geeft, dient er iedere minuut een nieuwe oproep naar `/verbinding` gedaan te worden totdat deze oproep slaagt.

## 6.2 Error in aanroep dienstgerelateerde endpoints

| Status-code | Aanbevolen acties. |
| --- | --- |
| **403** | Ongeautoriseerde oproep. Herstel is noodzakelijk voor een nieuwe poging. |
| **400** | Bij een 400 wegens fouten in de header of het bericht: herstel eerst de fout en stuur dan een nieuw bericht met de herstelde gegevens. |
| **50x** | De CDT Meldingen API is niet bereikbaar. Probeer na 1 minuut opnieuw (zelfde message body, ander-tijdstip, zelfde berichtId). |


## 6.3 Error in aanroep /verbinding

| Status-code | Aanbevolen acties. |
| --- | --- |
| **40x** | Er is een fout gemaakt in de aanroep. Probeer opnieuw met een nieuw bericht. |
| **50x** | De CDT Meldingen API is niet bereikbaar. Probeer na 1 minuut opnieuw met een nieuwe aanroep van /verbinding. |


## 6.4 Duplicaat detectie

Er is **geen duplicaat-detectie**, een bericht dat voor de tweede keer wordt aangeboden wordt functioneel afgewezen.

- - -

# 7 AUTHENTICATIE EN INFORMATIEBEVEILIGING

## 7.1 Authenticatie

### 7.1.1 PKI Certificaten

Authenticatie vindt plaats met behulp van **PKI overheid servercertificaten** en **clientcertificaten** bij de ICT-dienstverlener.

### 7.1.2 Authenticatie rijbewijs

Bij iedere dienst die wordt gestart dient het **Nederlandse rijbewijs** van de chauffeur **elektronisch** te worden geauthenticeerd via **NFC** door de 'Active Authentication' uit te voeren \[REF-2\].

### 7.1.3 Authenticatie kentekenbewijs

Bij het aanmelden van een voertuig voor een vervoerder dient het **kentekenbewijs** van het voertuig te worden geauthenticeerd middels de 'Active Authentication' \[REF-3\].

## 7.2 Informatiebeveiliging

Alleen **vooraf vrijgegeven IP-adressen** kunnen berichten aanbieden op de beveiligde API-gateway.

### 7.2.1 Transport Layer Security (TLS)

Het verkeer vindt plaats over **TLS** met certificaten aan verzendende en ontvangende zijde. De meest actuele richtlijnen van het NCSC zijn leidend.

### 7.2.2 API-keys

De ILT geeft per ICT-dienstverlener een **API-key** (`ext_key`\-header) uit, de ICT-dienstverlener gebruikt de API-key om zich bij de ILT API-gateway te identificeren.

## 7.3 Headers

De CDT-Meldingen API verwacht de volgende headers:

| Header | Waarde | voorbeeld |
| --- | --- | --- |
| **Accept** | Vaste waarde | `Accept: application/json` |
| **Content-Type** | Vaste waarde | `Content-Type: application/json` |
| **Dienstverlener** | UUID | `Dienstverlener: <uuid>` |
| **ext\_key** | UUID | `ext_key: <uuid>` |
| **Bericht-Id** | UUID | `Bericht-ld: <uuid>` |
| **Verzendtijdstip** | `date-time` in UTC conform IETF RFC3339 | `Verzendtijdstip: 20241120T17:51:01.556Z` |
| **Softwareversie-Registratiemiddel** | Max 20 posities | `Softwareversie-Registratiemiddel: v1.0.3` |
| **Softwareversie-Centrale-Applicatie** | Max. 20 posities | `Softwareversie-Centrale-Applicatie: v12.6.5` |
